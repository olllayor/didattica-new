<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %}Didattica{% endblock %}</title>
    <link
      href="https://cdn.jsdelivr.net/npm/daisyui@4.12.23/dist/full.min.css"
      rel="stylesheet"
      type="text/css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/rippleui@1.12.1/dist/css/styles.css"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <style>
      /* Apply Geist Mono font globally */
      @import url("https://fonts.cdnfonts.com/css/geist");
      body {
        font-family: "Geist", monospace;
      }
      .toast-message {
        animation: slideIn 0.5s ease-out;
      }
      .toast-message.success {
        background-color: #10b981; /* Green */
      }
      .toast-message.error {
        background-color: #ef4444; /* Red */
      }
      @keyframes slideIn {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }
    </style>
  </head>
  <body class="bg-gray-50">
    <!-- Main Content -->
    <main class="pb-20 md:pb-0 md:ml-16">
      <!-- Adjust padding for mobile and desktop -->
      <!-- Toast Messages Container -->
      <div class="fixed top-4 right-4 z-50 space-y-2">
        {% for message in messages %}
        <div
          class="toast-message {% if message.tags %}{{ message.tags }}{% endif %} p-4 rounded-lg shadow-lg text-white flex items-center justify-between"
        >
          <span>{{ message }}</span>
          <button onclick="this.parentElement.remove()" class="ml-4">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-5 w-5"
              viewBox="0 0 20 20"
              fill="currentColor"
            >
              <path
                fill-rule="evenodd"
                d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
                clip-rule="evenodd"
              />
            </svg>
          </button>
        </div>
        {% endfor %}
      </div>

      {% block content %}{% endblock %}
    </main>

    <!-- Include Components -->
    {% include "components/create-post-button.html" %}
    {% include "components/create-post-modal.html" %}
    {% include "components/image-preview-modal.html" %}

    <!-- Bottom Navigation Bar (Mobile) -->
    <div class="fixed bottom-0 left-0 w-full bg-base-200 z-40 md:hidden">
      <ul
        class="menu menu-horizontal rounded-box flex justify-center gap-6 p-4"
      >
        <li>
          <a href="{% url 'feed' %}" class="tooltip" data-tip="Home">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-5 w-5"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"
              />
            </svg>
          </a>
        </li>
        <li>
          <a href="#" class="tooltip" data-tip="Search">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-5 w-5"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
              />
            </svg>
          </a>
        </li>
        <li>
          <a
            href="{% url 'create_post' %}"
            class="tooltip"
            data-tip="Create Post"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-5 w-5"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 4v16m8-8H4"
              />
            </svg>
          </a>
        </li>
        <li>
          <a href="#" class="tooltip" data-tip="Bookmarks">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-5 w-5"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"
              />
            </svg>
          </a>
        </li>
        <li>
          <a
            href="{% url 'profile' username=request.user.username %}"
            class="tooltip"
            data-tip="Profile"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-5 w-5"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
              />
            </svg>
          </a>
        </li>
      </ul>
    </div>

    <!-- Old Sidebar (Desktop) -->
    <div
      class="hidden md:block fixed left-0 top-0 h-full w-16 flex flex-col items-center justify-center border-r bg-white"
    >
      <nav class="flex flex-col items-center gap-14">
        <a
          href="{% url 'feed' %}"
          class="mb-8 mt-3 transition-all duration-200 ease-out hover:scale-110 transform"
        >
          <svg
            version="1.0"
            xmlns="http://www.w3.org/2000/svg"
            class="w-14 h-14"
            viewBox="0 0 512.000000 512.000000"
            preserveAspectRatio="xMidYMid meet"
            fill="currentColor"
            stroke="none"
          >
            <g
              transform="translate(0.000000,512.000000) scale(0.100000,-0.100000)"
            >
              <path
                d="M4320 4655 c-242 -49 -597 -235 -1015 -535 -82 -59 -160 -111 -172 -114 -13 -4 -60 5 -120 23 -393 121 -815 80 -1183 -115 -336 -179 -609 -505 -729 -871 -58 -175 -75 -288 -75 -483 0 -181 15 -284 61 -435 15 -49 27 -104 27 -121 0 -23 -26 -67 -103 -173 -399 -555 -600 -999 -552 -1217 19 -82 73 -136 155 -155 217 -48 662 153 1212 549 77 54 149 102 161 106 13 4 59 -5 120 -23 664 -205 1383 62 1756 651 235 371 297 846 167 1270 -17 53 -30 103 -30 111 0 8 58 96 129 196 381 534 579 975 532 1186 -31 137 -148 189 -341 150z m-36 -387 c-12 -42 -78 -182 -131 -279 -74 -138 -179 -301 -302 -471 -132 -183 -166 -246 -182 -326 -14 -77 -7 -150 26 -252 45 -143 58 -228 58 -375 0 -149 -9 -215 -49 -354 -104 -358 -411 -674 -764 -785 -254 -81 -525 -81 -759 -1 -143 48 -264 43 -374 -18 -31 -18 -125 -81 -209 -141 -181 -131 -400 -267 -546 -341 -113 -57 -212 -98 -218 -92 -8 7 26 88 85 207 96 189 237 413 402 637 38 50 79 113 92 140 53 103 58 229 16 349 -66 191 -83 444 -41 634 68 313 247 580 504 753 205 137 416 200 673 200 147 0 263 -18 389 -62 119 -42 246 -37 347 15 26 13 100 62 165 110 137 100 304 211 419 279 133 78 364 191 398 194 5 1 5 -9 1 -21z"
              />
              <path
                d="M3570 3789 c-25 -8 -93 -68 -248 -222 l-212 -211 -28 17 c-57 38 -190 97 -263 117 -42 11 -117 24 -167 29 -676 62 -1200 -564 -1021 -1219 19 -72 78 -205 116 -262 l17 -28 -211 -212 c-179 -181 -213 -219 -222 -256 -36 -132 78 -247 210 -212 38 10 73 41 256 223 l213 211 37 -23 c235 -141 512 -181 771 -111 266 73 501 272 618 525 135 293 114 634 -57 918 l-23 37 211 213 c182 183 213 218 223 256 14 53 7 98 -23 142 -41 61 -124 89 -197 68z m-857 -625 c33 -8 80 -25 104 -36 l45 -21 -423 -423 c-474 -474 -428 -443 -470 -323 -30 86 -37 247 -15 342 52 223 235 408 454 461 79 20 231 20 305 0z m452 -456 c19 -81 19 -215 0 -296 -52 -220 -237 -405 -457 -457 -126 -29 -296 -14 -404 36 l-46 22 423 423 424 424 22 -45 c13 -24 30 -73 38 -107z"
              />
            </g>
          </svg>
        </a>

        <a href="{% url 'feed' %}" class="hover:opacity-70">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="w-7 h-7"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
            <polyline points="9 22 9 12 15 12 15 22" />
          </svg>
        </a>
        <a href="{% url 'search' %}">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="w-7 h-7"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <circle cx="11" cy="11" r="8" />
            <line x1="21" y1="21" x2="16.65" y2="16.65" />
          </svg>
        </a>
        <a href="{% url 'create_post' %}" class="hover:opacity-70">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="w-7 h-7"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />
            <line x1="12" y1="8" x2="12" y2="16" />
            <line x1="8" y1="12" x2="16" y2="12" />
          </svg>
        </a>
        <a href="#" class="hover:opacity-70">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="w-7 h-7"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M17.593 3.322c1.1.128 1.907 1.077 1.907 2.185V21L12 17.25 4.5 21V5.507c0-1.108.806-2.057 1.907-2.185a48.507 48.507 0 0 1 11.186 0Z"
            />
          </svg>
        </a>
        <a
          href="{% url 'profile' username=request.user.username %}"
          class="hover:opacity-70"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="w-7 h-7"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
            <circle cx="12" cy="7" r="4" />
          </svg>
        </a>
      </nav>
    </div>

    <script>
      // Automatically remove toast messages after 3 seconds
      document.addEventListener("DOMContentLoaded", function () {
        const toastMessages = document.querySelectorAll(".toast-message");
        toastMessages.forEach((toast) => {
          setTimeout(() => {
            toast.remove();
          }, 3000); // 5 seconds
        });
      });

      // Modal Functions
      function openCreatePostModal() {
        document.getElementById('createPostModal').classList.remove('hidden');
        document.body.classList.add('overflow-hidden');
      }

      function closeCreatePostModal() {
        document.getElementById('createPostModal').classList.add('hidden');
        document.body.classList.remove('overflow-hidden');
      }

      function openImagePreviewModal(images, index = 0) {
        const modal = document.getElementById('imagePreviewModal');
        const previewedImage = document.getElementById('previewedImage');

        // Set the image URLs and current index
        imageUrls = images;
        currentImageIndex = index;

        // Show the first image
        previewedImage.src = imageUrls[currentImageIndex];
        modal.classList.remove('hidden');
        document.body.classList.add('overflow-hidden');

        // Add keyboard event listeners
        document.addEventListener('keydown', handleKeyboardNavigation);
      }

      function closeImagePreviewModal() {
        const modal = document.getElementById('imagePreviewModal');
        modal.classList.add('hidden');
        document.body.classList.remove('overflow-hidden');

        // Remove keyboard event listeners
        document.removeEventListener('keydown', handleKeyboardNavigation);

        // Reset state
        currentImageIndex = 0;
        imageUrls = [];
      }

      function showNextImage() {
        if (currentImageIndex < imageUrls.length - 1) {
          currentImageIndex++;
          document.getElementById('previewedImage').src = imageUrls[currentImageIndex];
        }
      }

      function showPreviousImage() {
        if (currentImageIndex > 0) {
          currentImageIndex--;
          document.getElementById('previewedImage').src = imageUrls[currentImageIndex];
        }
      }

      function handleKeyboardNavigation(event) {
        if (event.key === 'ArrowLeft') {
          showPreviousImage();
        } else if (event.key === 'ArrowRight') {
          showNextImage();
        }
      }

      // Add click event listeners to navigation buttons
      document.getElementById('prevImageButton').addEventListener('click', showPreviousImage);
      document.getElementById('nextImageButton').addEventListener('click', showNextImage);
    </script>
  </body>
</html>